# pip install openpyxl
from openpyxl import load_workbook
import urllib.request

# clean journal title
def cleanString(string):
	stringnew = string.replace("'", "").replace("\"", "").replace("\"", "").replace(chr(0x00e9), 'e')
	return stringnew

# download file
def downloadXLSX(url,file):
	urllib.request.urlretrieve(url, file)

# parse xlsx file
def parseXLSX(gbltext,top1list,file):
	wb = load_workbook(file)
	sheet = wb['Sheet1']
	i = 0
	for row in sheet.iter_rows(row_offset=1):
		i += 1
		if row[5].value != "-" and row[1].value:
			quartile = row[5].value
			title = cleanString(row[1].value.lower())
			if cleanString(row[1].value.lower()) in top1list:
				quartile = "TOP1"
			gbltext += "ADD\n284\nF\nif &unifor('Q'v463^C)='" + title + "' then '" + quartile + "' fi/\nXXXXXXXXXXXXXXXXXXX\n"
			print(str(i) + ") " + title + " - " + quartile)
			
	file = open("result.gbl", "w")
	file.write(gbltext.encode('ascii','ignore').decode('unicode_escape'))
	file.close()

# main program
url = "http://scimagojr.com/journalrank.php?out=xls"
file = "test.xlsx"
gbltext = "0\n"
top1list = ["academy of management annals", "academy of management journal", "academy of management review", "accounts of chemical research", "acs nano", "acta mathematica", "acta neuropathologica", "acta numerica", "administrative science quarterly", "advanced drug delivery reviews", "advanced energy materials", "advanced functional materials", "advanced materials", "advances in experimental social psychology", "advances in optics and photonics", "advances in physics", "aldrichimica acta", "american economic journal: applied economics", "american economic journal: economic policy", "american economic journal: macroeconomics", "american economic review", "american journal of human genetics", "american journal of psychiatry", "american journal of respiratory and critical care medicine", "american political science review", "angewandte chemie - international edition", "annals of internal medicine", "annals of mathematics", "annals of neurology", "annals of statistics", "annual review of astronomy and astrophysics", "annual review of biochemistry", "annual review of biophysics", "annual review of cell and developmental biology", "annual review of clinical psychology", "annual review of condensed matter physics", "annual review of earth and planetary sciences", "annual review of ecology, evolution, and systematics", "annual review of economics", "annual review of entomology", "annual review of fluid mechanics", "annual review of genetics", "annual review of genomics and human genetics", "annual review of immunology", "annual review of marine science", "annual review of materials research", "annual review of medicine", "annual review of microbiology", "annual review of neuroscience", "annual review of nuclear and particle science", "annual review of nutrition", "annual review of pathology: mechanisms of disease", "annual review of pharmacology and toxicology", "annual review of physical chemistry", "annual review of physiology", "annual review of plant biology", "annual review of psychology", "applied physics reviews", "astrophysical journal, supplement series", "biological psychiatry", "biological reviews", "blood", "brain", "bulletin of the american meteorological society", "ca - a cancer journal for clinicians", "cancer cell", "cancer discovery", "cancer research", "cell", "cell host and microbe", "cell metabolism", "cell reports", "cell stem cell", "chemical reviews", "chemical society reviews", "circulation", "circulation research", "clinical cancer research", "clinical microbiology reviews", "cold spring harbor perspectives in biology", "criminology", "critical reviews in biochemistry and molecular biology", "current opinion in cell biology", "current opinion in genetics and development", "current opinion in neurobiology", "current opinion in structural biology", "development", "developmental cell", "diabetes", "diabetes care", "duke mathematical journal", "earth system science data", "ecological monographs", "ecology letters", "econometrica", "elife", "embo journal", "embo molecular medicine", "endocrine reviews", "energy and environmental sciences", "european heart journal", "european urology", "family business review", "fems microbiology reviews", "foundations and trends in machine learning", "frontiers in ecology and the environment", "gastroenterology", "genes and development", "genome biology", "genome research", "geochemical perspectives", "global change biology", "gut", "handbook of public economics", "handbook of the economics of finance", "ieee transactions on fuzzy systems", "ieee transactions on pattern analysis and machine intelligence", "immunity", "immunological reviews", "international journal of computer vision", "inventiones mathematicae", "isme journal", "jama - journal of the american medical association", "jama internal medicine", "jama psychiatry", "journal of accounting and economics", "journal of accounting research", "journal of allergy and clinical immunology", "journal of cell biology", "journal of clinical investigation", "journal of clinical oncology", "journal of economic literature", "journal of economic perspectives", "journal of engineering education", "journal of experimental medicine", "journal of finance", "journal of financial economics", "journal of labor economics", "journal of management", "journal of marketing", "journal of marketing research", "journal of political economy", "journal of public administration research and theory", "journal of supply chain management", "journal of the american chemical society", "journal of the american college of cardiology", "journal of the american mathematical society", "journal of the european economic association", "journal of the national cancer institute", "journal of the royal statistical society. series b: statistical methodology", "the lancet", "the lancet infectious diseases", "the lancet neurology", "the lancet oncology", "leukemia", "light: science and applications", "living reviews in relativity", "living reviews in solar physics", "materials science and engineering: r: reports", "materials today", "methods in ecology and evolution", "microbiology and molecular biology reviews", "microbiome", "mis quarterly: management information systems", "mmwr. morbidity and mortality weekly report", "mmwr. recommendations and reports : morbidity and mortality weekly report. recommendations and reports / centers for disease control", "mmwr. surveillance summaries : morbidity and mortality weekly report. surveillance summaries / cdc", "molecular aspects of medicine", "molecular biology and evolution", "molecular cell", "molecular psychiatry", "molecular systems biology", "nano letters", "nano today", "national vital statistics reports : from the centers for disease control and prevention, national center for health statistics, national vital statistics system", "nature", "nature biotechnology", "nature cell biology", "nature chemical biology", "nature chemistry", "nature climate change", "nature communications", "nature genetics", "nature geoscience", "nature immunology", "nature materials", "nature medicine", "nature methods", "nature nanotechnology", "nature neuroscience", "nature photonics", "nature physics", "nature protocols", "nature reviews cancer", "nature reviews clinical oncology", "nature reviews drug discovery", "nature reviews genetics", "nature reviews immunology", "nature reviews microbiology", "nature reviews molecular cell biology", "nature reviews neuroscience", "nature structural and molecular biology", "neuron", "neuroscience and biobehavioral reviews", "new england journal of medicine", "nih consensus and state-of-the-science statements", "nucleic acids research", "organization science", "organizational research methods", "paediatric and perinatal epidemiology", "personality and social psychology review", "personnel psychology", "perspectives on psychological science", "pharmacological reviews", "physics reports", "physiological reviews", "plant cell", "plos biology", "plos genetics", "plos medicine", "plos pathogens", "political analysis", "proceedings of the national academy of sciences of the united states of america", "progress in energy and combustion science", "progress in materials science", "progress in neurobiology", "progress in polymer science", "psychological bulletin", "psychological methods", "psychological review", "psychological science in the public interest : a journal of the american psychological society", "publications mathematiques", "quarterly journal of economics", "reports on progress in physics", "review of economic studies", "review of financial studies", "reviews of geophysics", "reviews of modern physics", "rhinology. supplement", "science", "science translational medicine", "seminars in cancer biology", "silence", "stem cell reports", "strategic management journal", "studies in mycology", "systematic biology", "the lancet diabetes and endocrinology", "the lancet global health", "the lancet respiratory medicine", "trends in biochemical sciences", "trends in cell biology", "trends in cognitive sciences", "trends in ecology and ecolution", "trends in endocrinology and metabolism", "trends in genetics", "trends in immunology", "trends in microbiology", "trends in molecular medicine", "trends in neurosciences", "trends in pharmacological sciences", "trends in plant science", "vital & health statistics. series 3, analytical and epidemiological studies / [u.s. dept. of health and human services, public health service, national center for health statistics]", "vital and health statistics. series 10, data from the national health survey", "wiley interdisciplinary reviews: computational molecular science"]

downloadXLSX(url,file)
parseXLSX(gbltext,top1list,file)
print("DONE!")